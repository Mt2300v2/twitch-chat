<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Twitch Chat Stats</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            background-color: #121212;
            color: white;
            font-family: Arial, sans-serif;
            text-align: center;
        }
        canvas {
            display: none;
            max-width: 800px;
            margin: auto;
        }
        button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #1f1f1f;
            color: white;
            border: none;
            cursor: pointer;
        }
        button:hover {
            background-color: #333;
        }
    </style>
</head>
<body>
    <h1>Twitch Chat Statistics</h1>
    <div>
        <button onclick="showChart('messagesPerChannel')">Messages per Channel</button>
        <button onclick="showChart('topUsers')">Top Active Users</button>
        <button onclick="showChart('messagesOverTime')">Messages Over Time</button>
        <button onclick="showChart('uniqueUsersPerChannel')">Unique Users per Channel</button>
    </div>
    <canvas id="messagesPerChannel"></canvas>
    <canvas id="topUsers"></canvas>
    <canvas id="messagesOverTime"></canvas>
    <canvas id="uniqueUsersPerChannel"></canvas>
    <script>
        async function fetchData() {
            const response = await fetch('https://raw.githubusercontent.com/Mt2300v2/twitch-chat/refs/heads/main/chat_logs.csv');
            const text = await response.text();
            return text.split('\n').map(line => line.split(','));
        }

        async function processCSV() {
            const data = await fetchData();
            const channelCounts = {};
            const userCounts = {};
            const messagesOverTime = {};
            const uniqueUsersPerChannel = {};

            data.forEach(row => {
                if (row.length < 4) return;
                const [timestamp, channel, user] = row;
                channelCounts[channel] = (channelCounts[channel] || 0) + 1;
                userCounts[user] = (userCounts[user] || 0) + 1;
                
                const time = timestamp.split('T')[0];
                messagesOverTime[time] = (messagesOverTime[time] || 0) + 1;
                
                if (!uniqueUsersPerChannel[channel]) uniqueUsersPerChannel[channel] = new Set();
                uniqueUsersPerChannel[channel].add(user);
            });

            Object.keys(uniqueUsersPerChannel).forEach(channel => {
                uniqueUsersPerChannel[channel] = uniqueUsersPerChannel[channel].size;
            });

            createChart('messagesPerChannel', 'Messages per Channel', channelCounts);
            createChart('topUsers', 'Top Active Users', userCounts, 10);
            createChart('messagesOverTime', 'Messages Over Time', messagesOverTime);
            createChart('uniqueUsersPerChannel', 'Unique Users per Channel', uniqueUsersPerChannel);
        }

        function createChart(canvasId, label, data, limit = 20) {
            const sortedEntries = Object.entries(data).sort((a, b) => b[1] - a[1]).slice(0, limit);
            new Chart(document.getElementById(canvasId), {
                type: 'bar',
                data: {
                    labels: sortedEntries.map(e => e[0]),
                    datasets: [{
                        label: label,
                        data: sortedEntries.map(e => e[1]),
                        backgroundColor: 'rgba(75, 192, 192, 0.5)'
                    }]
                },
                options: { responsive: true }
            });
        }

        function showChart(chartId) {
            document.querySelectorAll('canvas').forEach(canvas => canvas.style.display = 'none');
            document.getElementById(chartId).style.display = 'block';
        }

        processCSV();
    </script>
</body>
</html>
